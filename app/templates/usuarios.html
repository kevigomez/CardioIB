<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Usuarios</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tablas_usuarios.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    
    <script src="https://kit.fontawesome.com/6131ecdde6.js" crossorigin="anonymous"></script>
</head>
<body>
    {% extends "base.html" %}
    {% block content %}
    <div class="container_users">
    <div class="tabla_us">
    <div>
        <h1>Lista de Usuarios</h1>
        </div>
        <div class="butt_acc">
    <div>
        <a href="{{ url_for('main.reg_usuarios') }}">Registrar pacientes</a>
        <a href="{{ url_for('main.reg_usuariosAses') }}">Registrar Usuarios</a>
        </div>
    <div>
        <!-- Campo de búsqueda -->
        <input type="text" id="searchInput" class="form-control mb-3" placeholder="Buscar usuarios...">    
        </div>
    </div>
    
        <table class="table table-striped" id="user-table">
            <thead>
                <tr>
                    <th scope="col">Nombre de Usuario</th>
                    <th scope="col">Nombre</th>
                    <th scope="col">Apellido</th>
                    <th scope="col">Correo</th>
                    <th scope="col">Teléfono</th>
                    <th scope="col">RUT - CC</th>
                    <th scope="col">Estado</th>
                    <th scope="col">Accion</th>
                </tr>
            </thead>
            <tbody>
                {% for usuario in users.items %}
                <tr>
                    <td>{{ usuario.username }}</td>
                    <td>{{ usuario.fname }}</td>
                    <td>{{ usuario.lname }}</td>
                    <td>{{ usuario.email }}</td>
                    <td>{{ usuario.phone }}</td>
                    <td>{{ usuario.organization }}</td>
                    <td>
                        {% if usuario.status_id == 1 %}
                            Activo
                        {% elif usuario.status_id == 2 %}
                            Esperando   
                        {% elif usuario.status_id == 3 %}
                            Inactivo
                        {% else %}
                            Desconocido
                        {% endif %}
                    </td>
                    <td class="accion"><a href="{{ url_for('main.updateUsers', user_id=usuario.user_id) }}"><i class="fa-solid fa-pen-to-square"></i></a> <a href="{{ url_for('main.delete_users', user_id=usuario.user_id) }}"><i class="fa-solid fa-trash" style="color: #ee2b2b;"></i></a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <div>
            {% if users.has_prev %}
                <a href="{{ url_for('main.usuarios', page=1) }}"><i class="fa-solid fa-angles-left"></i></a>
                <a href="{{ url_for('main.usuarios', page=users.prev_num) }}"><i class="fa-solid fa-arrow-left"></i></a>
            {% endif %}
            
            Página {{ users.page }} de {{ users.pages }}
            
            {% if users.has_next %}
                <a href="{{ url_for('main.usuarios', page=users.next_num) }}"><i class="fa-solid fa-arrow-right"></i></a>
                <a href="{{ url_for('main.usuarios', page=users.pages) }}"><i class="fa-solid fa-angles-right"></i></a>
            {% endif %}
        </div>
    </div>
</div>

    <script>
        document.getElementById('searchInput').addEventListener('keyup', function() {
            let input = this.value.toLowerCase();
            let table = document.getElementById('user-table');
            let rows = table.getElementsByTagName('tr');

            for (let i = 1; i < rows.length; i++) {
                let cells = rows[i].getElementsByTagName('td');
                let match = false;
                for (let j = 0; j < cells.length; j++) {
                    if (cells[j].innerText.toLowerCase().includes(input)) {
                        match = true;
                        break;
                    }
                }
                rows[i].style.display = match ? '' : 'none';
            }
        });
    </script>
    {% endblock %}
</body>
</html>
